var TicTacToe=angular.module("TicTacToe",[]);TicTacToe.controller("TimerController",["$scope","$timeout","$filter",function(a,b,c){var d=localStorage.getItem("data");d=!!d&&JSON.parse(d);var e=d?d.startDate:Date.now(),f=d?d.endDate:e,g=null,h=function(b,d){a.clock=d-b,a.clockTime=c("date")(a.clock,"mm:ss:sss"),a.clockTime=a.clockTime.slice(0,a.clockTime.length-1)},i=function(){f+=10,h(e,f),g=b(i,a.tickInterval),localStorage.setItem("data",JSON.stringify({startDate:e,endDate:f}))},j=function(){a.snapshots=[]};a.tickInterval=10,a.isTimerRunning=JSON.parse(localStorage.getItem("isTimerRunning")),a.snapshots=localStorage.getItem("snapshots")?JSON.parse(localStorage.getItem("snapshots")):[],a.toogleTimer=function(){a.isTimerRunning=!a.isTimerRunning,a.isTimerRunning?i():b.cancel(g),localStorage.setItem("isTimerRunning",a.isTimerRunning)},a.stopTimer=function(){a.isTimerRunning=!1,b.cancel(g),f=e,h(e,f),j(),localStorage.setItem("isTimerRunning",!1),localStorage.setItem("data",JSON.stringify({startDate:e,endDate:f})),localStorage.setItem("snapshots",JSON.stringify([]))},a.takeTimerSnapshot=function(){~a.snapshots.indexOf(a.clockTime)||(a.snapshots.push(a.clockTime),localStorage.setItem("snapshots",JSON.stringify(a.snapshots)))},a.removeSnapshot=function(b){a.snapshots.splice(b,1),localStorage.setItem("snapshots",JSON.stringify(a.snapshots))},a.isTimerRunning&&i(),h(e,f),window.addEventListener("storage",function(c){switch(c.key){case"data":var d=JSON.parse(c.newValue);f=d.endDate+10,h(d.startDate,d.endDate),a.$apply();break;case"isTimerRunning":a.isTimerRunning=!a.isTimerRunning,a.isTimerRunning||b.cancel(g);break;case"snapshots":a.snapshots=JSON.parse(c.newValue),a.$apply()}}),localStorage.setItem("isTimerRunning",a.isTimerRunning)}]);